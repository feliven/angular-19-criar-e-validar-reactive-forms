<div class="cadastro-form">
  <div class="cadastro-form__container">
    <div class="cadastro-form__card">
      <h2 class="cadastro-form__title">
        {{ configuracaoDeFormulario.titulo }}
      </h2>

      <p class="cadastro-form__description">
        {{ configuracaoDeFormulario.descricao }}
      </p>

      <form [formGroup]="dadosPessoaisForm" (ngSubmit)="onProximo()">
        @for (campo of configuracaoDeFormulario.campos; track $index) { @if
        (retornaTipoDeCampoFormulario(campo, "text") ||
        retornaTipoDeCampoFormulario(campo, "email")) {
        <div
          class="cadastro-form__field"
          [ngClass]="{ 'cadastro-form__field--half': campo.width === 'half' }"
        >
          <label [for]="campo.formControlName" class="cadastro-form__label">{{
            campo.label
          }}</label>
          <input
            [id]="campo.formControlName"
            [type]="campo.type"
            class="cadastro-form__input"
            [formControlName]="campo.formControlName"
            [placeholder]="campo.placeholder || ''"
          />
        </div>
        } @else if (retornaTipoDeCampoFormulario(campo, "password")) {

        <div
          class="cadastro-form__field"
          [ngClass]="{ 'cadastro-form__field--half': campo.width === 'half' }"
        >
          <label [for]="campo.formControlName" class="cadastro-form__label">{{
            campo.label
          }}</label>
          <input
            [id]="campo.formControlName"
            [type]="campo.type"
            class="cadastro-form__input"
            [formControlName]="campo.formControlName"
          />
        </div>

        } @else if (retornaTipoDeCampoFormulario(campo, "select")) {
        <div
          class="cadastro-form__field"
          [ngClass]="{ 'cadastro-form__field--half': campo.width === 'half' }"
        >
          <label [for]="campo.formControlName" class="cadastro-form__label">{{
            campo.label
          }}</label>
          <select
            [id]="campo.formControlName"
            class="cadastro-form__select"
            [formControlName]="campo.formControlName"
          >
            <option value="" disabled selected>{{ campo.placeholder }}</option>

            @if(campo.formControlName==="estado"){ @for (estado of (estados$ |
            async); track $index) {
            <option [value]="estado.sigla">{{ estado.nome }}</option>
            } } @else if (campo.formControlName==="cidade") { @for (cidade of
            (cidades$ | async); track $index) {
            <option [value]="cidade.nome">{{ cidade.nome }}</option>
            }}
          </select>
        </div>
        } @if ( dadosPessoaisForm.get(campo.formControlName)?.invalid &&
        dadosPessoaisForm.get(campo.formControlName)?.touched) { @for
        (mensagemErro of campo.errorMessages | keyvalue; track $index) { @if
        (dadosPessoaisForm.get(campo.formControlName)?.errors?.[mensagemErro.key])
        {
        <div class="cadastro-form__error">
          <span>{{ mensagemErro.value }}</span>
        </div>
        } } } }

        <!-- Campos de Estado e Cidade (lado a lado) -->
        <ng-container *ngIf="possuiCampo('estado') && possuiCampo('cidade')">
          <div class="cadastro-form__row">
            <!-- Campo Estado -->
            <div class="cadastro-form__field cadastro-form__field--half">
              <label for="estado" class="cadastro-form__label">{{
                getCampoPorNome("estado").label
              }}</label>
              <select
                id="estado"
                class="cadastro-form__select"
                formControlName="estado"
              >
                <option value="" disabled selected>
                  {{ getCampoPorNome("estado").placeholder || "Selecione" }}
                </option>
                <ng-container *ngIf="estados$ | async as estados">
                  <option *ngFor="let estado of estados" [value]="estado.sigla">
                    {{ estado.nome }}
                  </option>
                </ng-container>
              </select>
              <div
                *ngIf="
                  dadosPessoaisForm.get('estado')?.invalid &&
                  dadosPessoaisForm.get('estado')?.touched
                "
                class="cadastro-form__error"
              >
                <ng-container
                  *ngFor="
                    let error of getCampoPorNome('estado').errorMessages
                      | keyvalue
                  "
                >
                  <span
                    *ngIf="dadosPessoaisForm.get('estado')?.errors?.[error.key]"
                    >{{ error.value }}</span
                  >
                </ng-container>
              </div>
            </div>

            <!-- Campo Cidade -->
            <div class="cadastro-form__field cadastro-form__field--half">
              <label for="cidade" class="cadastro-form__label">{{
                getCampoPorNome("cidade").label
              }}</label>
              <select
                id="cidade"
                class="cadastro-form__select"
                formControlName="cidade"
                [disabled]="
                  (carregandoCidades$ | async) ||
                  !dadosPessoaisForm.get('estado')?.value
                "
              >
                <option value="" disabled selected>
                  {{
                    (carregandoCidades$ | async)
                      ? "Carregando..."
                      : getCampoPorNome("cidade").placeholder || "Selecione"
                  }}
                </option>
                <ng-container *ngIf="cidades$ | async as cidades">
                  <option *ngFor="let cidade of cidades" [value]="cidade.nome">
                    {{ cidade.nome }}
                  </option>
                </ng-container>
              </select>
              <div
                *ngIf="
                  dadosPessoaisForm.get('cidade')?.invalid &&
                  dadosPessoaisForm.get('cidade')?.touched
                "
                class="cadastro-form__error"
              >
                <ng-container
                  *ngFor="
                    let error of getCampoPorNome('cidade').errorMessages
                      | keyvalue
                  "
                >
                  <span
                    *ngIf="dadosPessoaisForm.get('cidade')?.errors?.[error.key]"
                    >{{ error.value }}</span
                  >
                </ng-container>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- Campos Senha e Confirma Senha (lado a lado) -->
        <ng-container
          *ngIf="possuiCampo('senha') && possuiCampo('repitaSenha')"
        >
          <div class="cadastro-form__row">
            <!-- Campo Senha -->
            <div class="cadastro-form__field cadastro-form__field--half">
              <label for="senha" class="cadastro-form__label">{{
                getCampoPorNome("senha").label
              }}</label>
              <input
                id="senha"
                type="password"
                class="cadastro-form__input"
                formControlName="senha"
              />
              <div
                *ngIf="
                  dadosPessoaisForm.get('senha')?.invalid &&
                  dadosPessoaisForm.get('senha')?.touched
                "
                class="cadastro-form__error"
              >
                <ng-container
                  *ngFor="
                    let error of getCampoPorNome('senha').errorMessages
                      | keyvalue
                  "
                >
                  <span
                    *ngIf="dadosPessoaisForm.get('senha')?.errors?.[error.key]"
                    >{{ error.value }}</span
                  >
                </ng-container>
              </div>
            </div>

            <!-- Campo Confirma Senha -->
            <div class="cadastro-form__field cadastro-form__field--half">
              <label for="repitaSenha" class="cadastro-form__label">{{
                getCampoPorNome("repitaSenha").label
              }}</label>
              <input
                id="repitaSenha"
                type="password"
                class="cadastro-form__input"
                formControlName="repitaSenha"
              />
              <div
                *ngIf="
                  dadosPessoaisForm.get('repitaSenha')?.invalid &&
                  dadosPessoaisForm.get('repitaSenha')?.touched
                "
                class="cadastro-form__error"
              >
                <ng-container
                  *ngFor="
                    let error of getCampoPorNome('repitaSenha').errorMessages
                      | keyvalue
                  "
                >
                  <span
                    *ngIf="dadosPessoaisForm.get('repitaSenha')?.errors?.[error.key]"
                    >{{ error.value }}</span
                  >
                </ng-container>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- Mensagem de erro para senhas não coincidentes -->
        <div
          *ngIf="dadosPessoaisForm.errors?.['senhasNaoIguais'] && dadosPessoaisForm.get('repitaSenha')?.touched"
          class="cadastro-form__error"
        >
          As senhas não coincidem
        </div>

        <div class="cadastro-form__actions">
          <app-button
            text="Anterior"
            type="outline"
            icon="fas fa-arrow-left"
            iconPosition="left"
            (clicked)="onAnterior()"
          >
          </app-button>

          <app-button
            text="Próximo"
            type="primary"
            icon="fas fa-arrow-right"
            iconPosition="right"
            [disabled]="dadosPessoaisForm.invalid"
            (clicked)="onProximo()"
          >
          </app-button>
        </div>
      </form>
    </div>
  </div>
</div>
